<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Bevis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="google重度依赖者，mac拥趸，热爱前沿技术，梦想全栈">
<meta property="og:type" content="website">
<meta property="og:title" content="Bevis">
<meta property="og:url" content="https://utopia1991.github.io/index.html">
<meta property="og:site_name" content="Bevis">
<meta property="og:description" content="google重度依赖者，mac拥趸，热爱前沿技术，梦想全栈">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bevis">
<meta name="twitter:description" content="google重度依赖者，mac拥趸，热爱前沿技术，梦想全栈">
  
  
    <link rel="icon" href="css/images/logo.jpg">
  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">
          <span class="brand-logo">Bevis</span>
          Blog
        </a>
      </h1>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">博文</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://utopia1991.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
        <aside id="sidebar">
  <div class="aside-author">
    <div class="aside-logo"></div>
    <p class="aside-title">Bevis Shen</p>
    <p class="aside-subtitle">Node & Front-End Programmer</p>
    <p class="aside-description">Google重度依赖者，Mac拥趸，热衷开源，对前沿技术有着狂热的激情，梦想全栈，旅游、电影爱好的文艺程序猿一枚</p>
    <div class="aside-communicate">
      <a href="https://github.com/utopia1991" target="_blank" class="article-share-github" title="github"></a>
      <a href="https://www.linkedin.com/in/bevis1991" target="_blank" class="article-share-linkedin" title="linkedin"></a>
      <a href="mailto:1304354608@qq.com" class="article-share-mail" title="email"></a>
      <a href="https://weibo.com/u/2619492527/home" target="_blank" class="article-share-weibo" title="weibo"></a>
      <a class="article-share-weixin" title="wechat"></a>
      <img src="css/images/wechat.png" width="180" height="180" class="wechat-pic none">
      <a class="article-share-qq" title="qq"></a>
      <img src="css/images/qq.png" width="180" height="180" class="qq-pic none">
      <a href="https://www.facebook.com/bevis1991" target="_blank" class="article-share-facebook" title="facebook"></a>
      <a href="https://twitter.com/bevis_shen" target="_blank" class="article-share-twitter" title="twitter"></a>
    </div>
  </div>
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/10/24/express/">Node.js Express 框架</a>
          </li>
        
          <li>
            <a href="/2016/10/24/commandLine/">Mac 常用终端命令</a>
          </li>
        
          <li>
            <a href="/2016/10/24/mvc/">MVC 可能快过气了</a>
          </li>
        
          <li>
            <a href="/2016/10/23/dust/">Dust 模版引擎</a>
          </li>
        
          <li>
            <a href="/2016/10/23/markdown/">Markdown 编辑器语法指南</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main">
          <div class="main-header">
            <span class="main-title">求知若饥 虚心若愚</span>
          </div>
          
  
    <article id="post-express" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/24/express/" class="article-date">
  <time datetime="2016-10-25T03:04:52.000Z" itemprop="datePublished">2016-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/24/express/">Node.js Express 框架</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Express-简介"><a href="#Express-简介" class="headerlink" title="Express 简介"></a>Express 简介</h2><p>Express 是一个简洁而灵活的 node.js Web应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。<br>使用 Express 可以快速地搭建一个完整功能的网站。<br>Express 框架核心特性：</p>
<ul>
<li>可以设置中间件来响应 HTTP 请求。</li>
<li>定义了路由表用于执行不同的 HTTP 请求动作。</li>
<li>可以通过向模板传递参数来动态渲染 HTML 页面。</li>
</ul>
<h3 id="请求和响应"><a href="#请求和响应" class="headerlink" title="请求和响应"></a>请求和响应</h3><p>Express 应用使用回调函数的参数： request 和 response 对象来处理请求和响应的数据。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="comment">// --</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h4 id="request-和-response-对象的具体介绍："><a href="#request-和-response-对象的具体介绍：" class="headerlink" title="request 和 response 对象的具体介绍："></a>request 和 response 对象的具体介绍：</h4><h4 id="Request-对象-request-对象表示-HTTP-请求，包含了请求查询字符串，参数，内容，HTTP-头部等属性。常见属性有："><a href="#Request-对象-request-对象表示-HTTP-请求，包含了请求查询字符串，参数，内容，HTTP-头部等属性。常见属性有：" class="headerlink" title="Request 对象 - request 对象表示 HTTP 请求，包含了请求查询字符串，参数，内容，HTTP 头部等属性。常见属性有："></a>Request 对象 - request 对象表示 HTTP 请求，包含了请求查询字符串，参数，内容，HTTP 头部等属性。常见属性有：</h4><ul>
<li>req.app：当callback为外部文件时，用req.app访问express的实例</li>
<li>req.baseUrl：获取路由当前安装的URL路径</li>
<li>req.body / req.cookies：获得「请求主体」/ Cookies</li>
<li>req.fresh / req.stale：判断请求是否还「新鲜」</li>
<li>req.hostname / req.ip：获取主机名和IP地址</li>
<li>req.originalUrl：获取原始请求URL</li>
<li>req.params：获取路由的parameters</li>
<li>req.path：获取请求路径</li>
<li>req.protocol：获取协议类型</li>
<li>req.query：获取URL的查询参数串</li>
<li>req.route：获取当前匹配的路由</li>
<li>req.subdomains：获取子域名</li>
<li>req.accpets（）：检查请求的Accept头的请求类型</li>
<li>req.acceptsCharsets / req.acceptsEncodings / req.acceptsLanguages</li>
<li>req.get（）：获取指定的HTTP请求头</li>
<li>req.is（）：判断请求头Content-Type的MIME类型</li>
</ul>
<h4 id="Response-对象-response-对象表示-HTTP-响应，即在接收到请求时向客户端发送的-HTTP-响应数据。常见属性有："><a href="#Response-对象-response-对象表示-HTTP-响应，即在接收到请求时向客户端发送的-HTTP-响应数据。常见属性有：" class="headerlink" title="Response 对象 - response 对象表示 HTTP 响应，即在接收到请求时向客户端发送的 HTTP 响应数据。常见属性有："></a>Response 对象 - response 对象表示 HTTP 响应，即在接收到请求时向客户端发送的 HTTP 响应数据。常见属性有：</h4><ul>
<li>res.app：同req.app一样</li>
<li>res.append（）：追加指定HTTP头</li>
<li>res.set（）在res.append（）后将重置之前设置的头</li>
<li>res.cookie（name，value [，option]）：设置Cookie</li>
<li>opition: domain / expires / httpOnly / maxAge / path / secure / signed</li>
<li>res.clearCookie（）：清除Cookie</li>
<li>res.download（）：传送指定路径的文件</li>
<li>res.get（）：返回指定的HTTP头</li>
<li>res.json（）：传送JSON响应</li>
<li>res.jsonp（）：传送JSONP响应</li>
<li>res.location（）：只设置响应的Location HTTP头，不设置状态码或者close response</li>
<li>res.redirect（）：设置响应的Location HTTP头，并且设置状态码302</li>
<li>res.send（）：传送HTTP响应</li>
<li>res.sendFile（path [，options] [，fn]）：传送指定路径的文件 -会自动根据文件extension设定Content-Type</li>
<li>res.set（）：设置HTTP头，传入object可以一次设置多个头</li>
<li>res.status（）：设置HTTP状态码</li>
<li>res.type（）：设置Content-Type的MIME类型</li>
</ul>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>我们已经了解了 HTTP 请求的基本应用，而路由决定了由谁(指定脚本)去响应客户端请求。<br>在HTTP请求中，我们可以通过路由提取出请求的URL以及GET/POST参数。<br>接下来我们扩展 Hello World，添加一些功能来处理更多类型的 HTTP 请求。<br>创建 express_demo2.js 文件，代码如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="comment">//  主页输出 "Hello World"</span></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"主页 GET 请求"</span>);</div><div class="line">   res.send(<span class="string">'Hello GET'</span>);</div><div class="line">&#125;)</div><div class="line"><span class="comment">//  POST 请求</span></div><div class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"主页 POST 请求"</span>);</div><div class="line">   res.send(<span class="string">'Hello POST'</span>);</div><div class="line">&#125;)</div><div class="line"><span class="comment">//  /del_user 页面响应</span></div><div class="line">app.delete(<span class="string">'/del_user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"/del_user 响应 DELETE 请求"</span>);</div><div class="line">   res.send(<span class="string">'删除页面'</span>);</div><div class="line">&#125;)</div><div class="line"><span class="comment">//  /list_user 页面 GET 请求</span></div><div class="line">app.get(<span class="string">'/list_user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"/list_user GET 请求"</span>);</div><div class="line">   res.send(<span class="string">'用户列表页面'</span>);</div><div class="line">&#125;)</div><div class="line"><span class="comment">// 对页面 abcd, abxcd, ab123cd, 等响应 GET 请求</span></div><div class="line">app.get(<span class="string">'/ab*cd'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"/ab*cd GET 请求"</span>);</div><div class="line">   res.send(<span class="string">'正则匹配'</span>);</div><div class="line">&#125;)</div><div class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> host = server.address().address</div><div class="line">  <span class="keyword">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h3><p>Express 提供了内置的中间件 express.static 来设置静态文件如：图片， CSS, JavaScript 等。<br>你可以使用 express.static 中间件来设置静态文件路径。例如，如果你将图片， CSS, JavaScript 文件放在 public 目录下，你可以这么写：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.use(express.static(<span class="string">'public'</span>));</div></pre></td></tr></table></figure></p>
<p>我们可以到 public/images 目录下放些图片,如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">node_modules</div><div class="line">server.js</div><div class="line">public/</div><div class="line">public/images</div><div class="line">public/images/logo.png</div></pre></td></tr></table></figure></p>
<p>让我们再修改下 “Hello Word” 应用添加处理静态文件的功能。<br>创建 express_demo3.js 文件，代码如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line">app.use(express.static(<span class="string">'public'</span>));</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">   res.send(<span class="string">'Hello World'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> host = server.address().address</div><div class="line">  <span class="keyword">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>执行以上代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ node express_demo3.js</div></pre></td></tr></table></figure></p>
<p>应用实例，访问地址为 <a href="http://0.0.0.0:8081" target="_blank" rel="external">http://0.0.0.0:8081</a><br>执行以上代码：<br>在浏览器中访问 <a href="http://127.0.0.1:8081/images/logo.png（本实例采用了菜鸟教程的logo），结果如下图所示：" target="_blank" rel="external">http://127.0.0.1:8081/images/logo.png（本实例采用了菜鸟教程的logo），结果如下图所示：</a></p>
<h3 id="GET-方法"><a href="#GET-方法" class="headerlink" title="GET 方法"></a>GET 方法</h3><p>以下实例演示了在表单中通过 GET 方法提交两个参数，我们可以使用 server.js 文件内的 process_get 路由器来处理输入：<br>index.htm 文件代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:8081/process_get"</span> <span class="attr">method</span>=<span class="string">"GET"</span>&gt;</span></div><div class="line">        First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"first_name"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">        Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"last_name"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>server.js 文件代码如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line">app.use(express.static(<span class="string">'public'</span>));</div><div class="line"></div><div class="line">app.get(<span class="string">'/index.htm'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.sendFile( __dirname + <span class="string">"/"</span> + <span class="string">"index.htm"</span> );</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.get(<span class="string">'/process_get'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="comment">// 输出 JSON 格式</span></div><div class="line">  response = &#123;</div><div class="line">      <span class="attr">first_name</span>:req.query.first_name,</div><div class="line">      <span class="attr">last_name</span>:req.query.last_name</div><div class="line">  &#125;;</div><div class="line">  <span class="built_in">console</span>.log(response);</div><div class="line">  res.end(<span class="built_in">JSON</span>.stringify(response));</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> host = server.address().address</div><div class="line">  <span class="keyword">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>执行以上代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node server.js</div></pre></td></tr></table></figure></p>
<p>应用实例，访问地址为 <a href="http://0.0.0.0:8081" target="_blank" rel="external">http://0.0.0.0:8081</a></p>
<h3 id="POST-方法"><a href="#POST-方法" class="headerlink" title="POST 方法"></a>POST 方法</h3><p>以下实例演示了在表单中通过 POST 方法提交两个参数，我们可以使用 server.js 文件内的 process_get 路由器来处理输入：<br>index.htm 文件代码修改如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:8081/process_post"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></div><div class="line">            First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"first_name"</span>&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">            Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"last_name"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>server.js 文件代码修改如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 创建 application/x-www-form-urlencoded 编码解析</span></div><div class="line"><span class="keyword">var</span> urlencodedParser = bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;)</div><div class="line"></div><div class="line">app.use(express.static(<span class="string">'public'</span>));</div><div class="line"></div><div class="line">app.get(<span class="string">'/index.htm'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.sendFile( __dirname + <span class="string">"/"</span> + <span class="string">"index.htm"</span> );</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.post(<span class="string">'/process_post'</span>, urlencodedParser, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="comment">// 输出 JSON 格式</span></div><div class="line">  response = &#123;</div><div class="line">      <span class="attr">first_name</span>:req.body.first_name,</div><div class="line">      <span class="attr">last_name</span>:req.body.last_name</div><div class="line">  &#125;;</div><div class="line">  <span class="built_in">console</span>.log(response);</div><div class="line">  res.end(<span class="built_in">JSON</span>.stringify(response));</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> host = server.address().address</div><div class="line">  <span class="keyword">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>执行以上代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ node server.js</div></pre></td></tr></table></figure></p>
<p>应用实例，访问地址为 <a href="http://0.0.0.0:8081" target="_blank" rel="external">http://0.0.0.0:8081</a></p>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>以下我们创建一个用于上传文件的表单，使用 POST 方法，表单 enctype 属性设置为 multipart/form-data。<br>index.htm 文件代码修改如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传表单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>文件上传：<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">        选择一个文件上传: <span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/file_upload"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"image"</span> <span class="attr">size</span>=<span class="string">"50"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传文件"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>server.js 文件代码修改如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</div><div class="line"><span class="keyword">var</span> multer  = <span class="built_in">require</span>(<span class="string">'multer'</span>);</div><div class="line"></div><div class="line">app.use(express.static(<span class="string">'public'</span>));</div><div class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</div><div class="line">app.use(multer(&#123; <span class="attr">dest</span>: <span class="string">'/tmp/'</span>&#125;).array(<span class="string">'image'</span>));</div><div class="line"></div><div class="line">app.get(<span class="string">'/index.htm'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.sendFile( __dirname + <span class="string">"/"</span> + <span class="string">"index.htm"</span> );</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.post(<span class="string">'/file_upload'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(req.files[<span class="number">0</span>]);  <span class="comment">// 上传的文件信息</span></div><div class="line">  <span class="keyword">var</span> des_file = __dirname + <span class="string">"/"</span> + req.files[<span class="number">0</span>].originalname;</div><div class="line">  fs.readFile( req.files[<span class="number">0</span>].path, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">        fs.writeFile(des_file, data, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>( err )&#123;</div><div class="line">              <span class="built_in">console</span>.log( err );</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">              response = &#123;</div><div class="line">                  <span class="attr">message</span>:<span class="string">'File uploaded successfully'</span>,</div><div class="line">                  <span class="attr">filename</span>:req.files[<span class="number">0</span>].originalname</div><div class="line">              &#125;;</div><div class="line">          &#125;</div><div class="line">          <span class="built_in">console</span>.log( response );</div><div class="line">          res.end( <span class="built_in">JSON</span>.stringify( response ) );</div><div class="line">      &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> host = server.address().address</div><div class="line">  <span class="keyword">var</span> port = server.address().port</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>执行以上代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ node express_demo.js</div></pre></td></tr></table></figure></p>
<p>应用实例，访问地址为 <a href="http://0.0.0.0:8081" target="_blank" rel="external">http://0.0.0.0:8081</a></p>
<h3 id="Cookie-管理"><a href="#Cookie-管理" class="headerlink" title="Cookie 管理"></a>Cookie 管理</h3><p>我们可以使用中间件向 Node.js 服务器发送 cookie 信息，以下代码输出了客户端发送的 cookie 信息：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// express_cookie.js 文件</span></div><div class="line"><span class="keyword">var</span> express      = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">'cookie-parser'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line">app.use(cookieParser())</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Cookies: "</span>, req.cookies)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">8081</span>)</div></pre></td></tr></table></figure></p>
<p>执行以上代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ node express_demo.js</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://utopia1991.github.io/2016/10/24/express/" data-id="ciuowik3x00008btdbp5dvkzy" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-commandLine" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/24/commandLine/" class="article-date">
  <time datetime="2016-10-25T02:48:06.000Z" itemprop="datePublished">2016-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/24/commandLine/">Mac 常用终端命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>OSX 采用的Unix文件系统，所有文件都挂在跟目录 / 下面，所以不在要有Windows 下的盘符概念。<br>你在桌面上看到的硬盘都挂在 /Volumes 下。<br>比如接上个叫做 USBHD的移动硬盘，桌面上会显示出一个硬盘图标，它实际在哪里呢？<br>在终端里执行 ls /Volumes/USBHD, 看看显示出的是不是这个移动硬盘的内容。<br>根目录位置是 / 核心 Mach_kernel 就在这里，<br>驱动所在位置 /Systme/Library/Extensions<br>用户文件夹位置 /User/用户名<br>桌面的位置 /User/用户名/Desktop<br>文件通配符为星号 *<br>注意：在 Unix系统中是区别大小写字符的，A.txt 不等于 a.txt。<br>根目录标志 / 不是可有可无，cd /System 表示转到跟目录下的System中，而cd System 表示转到当前目录下的 System中<br>如何进入命令行操作模式<br>再图形界面下，用finder 打开 应用程序 》实用程序》终端<br>如果连图形界面都进不去了（比如安错了显示驱动），开机时按 F8，用－s参数启动，然后输入命令 mount -uw / </p>
<h2 id="获得权限"><a href="#获得权限" class="headerlink" title="获得权限"></a>获得权限</h2><p>为了防止误操作破坏系统，再用户状态下时没有权限操作系统重要文件的，所以先要取得root权限<br>sudo －s<br>然后输入密码，输入密码时没有任何回显，连星号都没有，只管输完回车就行了。 </p>
<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><h3 id="列出文件"><a href="#列出文件" class="headerlink" title="列出文件"></a>列出文件</h3><p>ls 参数 目录名<br>例: 想看看跟目录下有什么，<br>ls / </p>
<h3 id="想看看驱动目录下有什么，"><a href="#想看看驱动目录下有什么，" class="headerlink" title="想看看驱动目录下有什么，"></a>想看看驱动目录下有什么，</h3><p>ls /System/Library/Extensions<br>参数 -w 显示中文，-l 详细信息， -a 包括隐藏文件 </p>
<h3 id="转换目录"><a href="#转换目录" class="headerlink" title="转换目录"></a>转换目录</h3><p>cd<br>例：想到驱动目录下溜达一圈<br>cd /System/Library/Extensions </p>
<h3 id="建立新目录"><a href="#建立新目录" class="headerlink" title="建立新目录"></a>建立新目录</h3><p>mkdir 目录名<br>例：在驱动目录下建一个备份目录 backup<br>mkdir /System/Library/Extensions/backup </p>
<h3 id="在桌面上建一个备份目录-backup"><a href="#在桌面上建一个备份目录-backup" class="headerlink" title="在桌面上建一个备份目录 backup"></a>在桌面上建一个备份目录 backup</h3><p>mkdir /User/用户名/Desktop/backup </p>
<h3 id="拷贝文件"><a href="#拷贝文件" class="headerlink" title="拷贝文件"></a>拷贝文件</h3><p>cp 参数 源文件 目标文件<br>例：想把桌面的Natit.kext 拷贝到驱动目录中<br>cp -R /User/用户名/Desktop/Natit.kext /System/Library/Extensions<br>参数R表示对目录进行递归操作，kext在图形界面下看起来是个文件，实际上是个文件夹。 </p>
<h3 id="把驱动目录下的所有文件备份到桌面backup"><a href="#把驱动目录下的所有文件备份到桌面backup" class="headerlink" title="把驱动目录下的所有文件备份到桌面backup"></a>把驱动目录下的所有文件备份到桌面backup</h3><p>cp -R /System/Library/Extensions/* /User/用户名/Desktop/backup </p>
<h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><p>rm 参数 文件<br>例：想删除驱动的缓存<br>rm -rf /System/Library/Extensions.kextcache<br>rm -rf /System/Library/Extensions.mkext<br>参数－rf 表示递归和强制，千万要小心使用，如果执行了 rm -rf / 你的系统就全没了 </p>
<h3 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h3><p>mv 文件<br>例：想把AppleHDA.Kext 移到桌面<br>mv /System/Library/Extensions/AppleHDA.kext /User/用户名/Desktop<br>想把AppleHDA.Kext 移到备份目录中<br>mv /System/Library/Extensions/AppleHDA.kext /System/Library/Extensions/backup </p>
<h3 id="更改文件权限"><a href="#更改文件权限" class="headerlink" title="更改文件权限"></a>更改文件权限</h3><p>chmod 参数 权限 文件<br>例：把驱动目录下所有文件设定到root读写，其他用户只读<br>chmod -R 755 /System/Library/Extensions<br>参数R 表示递归，755表示各用户的权限 </p>
<h3 id="更改文件属主"><a href="#更改文件属主" class="headerlink" title="更改文件属主"></a>更改文件属主</h3><p>chown 参数 用户:组 文件<br>例：把驱动目录下的所有文件属主改成根用户<br>chown -R root:wheel /System/Library/Extensions<br>参数R 表示递归操作 </p>
<h3 id="修复整个系统中文件的权限"><a href="#修复整个系统中文件的权限" class="headerlink" title="修复整个系统中文件的权限"></a>修复整个系统中文件的权限</h3><p>diskutil repairpermissions /<br>严格的说这不是一个unix 命令，而是osx一个软件，记得修改或添加的驱动就执行一次。 </p>
<h3 id="文本编辑"><a href="#文本编辑" class="headerlink" title="文本编辑"></a>文本编辑</h3><p>nano 文件名<br>例：编辑natit Info.plist<br>nano /System/Library/Extensions/Natit.kext/Info.plist<br>编辑完成后 用 Ctrl ＋O 存盘，Ctrl＋X 退出<br>另一个文本编辑软件是 vi，操作有些古怪，熟了是非常好用的，而且在所有类Unix系统中都它，走遍天下都不怕了。 </p>
<h3 id="运行脚本命令"><a href="#运行脚本命令" class="headerlink" title="运行脚本命令"></a>运行脚本命令</h3><p>sh 脚本文件名<br>例 修改驱动后所有需要的操作存成一个脚本，以后修改了驱动后只要运行一次这个脚本就可以了，方便吧 </p>
<ul>
<li>终端中运行nano /clean </li>
<li>把下列代码粘贴到 nano 中<br>rm -rf /System/Library/Extensions.kextcache<br>rm -rf /System/Library/Extensions.mkext<br>chown -R root:wheel /System/Library/Extensions<br>chmod -R 755 /System/Library/Extensions<br>diskutil repairpermissions /<br>kextcache -k /System/Library/Extensions/ </li>
<li>Ctrl ＋O 存盘，Ctrl＋X 退出 </li>
<li>以后只要动了驱动，就在终端中运行一次 sh /clean</li>
</ul>
<h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><p>用 Tab 键自动补齐命令<br>比如想到 /System 目录中去，输入 cd /Sy 然后按一下Tab 键，命令就会自动补齐成 cd /System<br>操作带名字中带有空格的文件和目录<br>空格在命令中写成 空格， 比如要进入 My Documents，命令为 cd My Documents<br>查看命令的详细帮助<br>man 命令名<br>比如要看看 ls 命令的详细用法，执行 man ls </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://utopia1991.github.io/2016/10/24/commandLine/" data-id="ciuovu5bj0001owtd327a2cny" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mvc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/24/mvc/" class="article-date">
  <time datetime="2016-10-25T02:36:42.000Z" itemprop="datePublished">2016-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/24/mvc/">MVC 可能快过气了</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>依我个人所见，后端框架，类似于MVC这样的组织方式已经显得过气了。</p>
<p>过去，在创建应用时通常会按MVC各建一个文件夹，每个文件夹就是一个模块。MVC三者的职责是这样的：</p>
<ul>
<li><p>Controller绑定到某个路由上，接着处理请求参数，然后创建在整个请求中可见的对象，并进行一些业务逻辑上的工作。期间会从数据库中构造Model，也有可能新建/修改Model后将它们保存入数据库。最后，Controller会通过View响应用户的请求，或者返回重定向的报文。基本上业务逻辑都是实现在Controller里面的。（下文为了阐述方便，都以“业务逻辑”特指Controller中的业务逻辑）</p>
</li>
<li><p>每个Model往往对应数据库的一个实体。Model类除了装数据之外，还提供了跟自己身份相关的一些方法，比如User类提供authenticate方法以用于验证密码。Model对象通常还会负责检验构造自己的参数是否正确。</p>
</li>
<li><p>View负责使用给定的参数渲染模板，并作为响应返回给用户。View一般是由该框架提供的模板语言写成。</p>
</li>
</ul>
<p>现在，一个后端应用如果还是按MVC的方式划分，似乎有些不适应了。</p>
<h2 id="后端MVC的历史"><a href="#后端MVC的历史" class="headerlink" title="后端MVC的历史"></a>后端MVC的历史</h2><p>我们先从后端MVC的历史开始讲起吧。MVC最初发端于客户端程序的开发，旨在用Controller在Model和View之间进行解耦。如果我没记错的话，gang of four的《设计模式》里面提到MVC，就是以客户端程序作为例子。</p>
<p>跟客户端开发类似的，后端程序一开始也只有View这一层。在很久很久以前，后端程序都是这样运行的：用户一个HTTP请求进来，服务器通过cgi调用一个程序生成文本作为响应。这时期大部分后端程序，看上去都像是模板语言（见过初学者写过的JSP/PHP吗？）。因为它们主要做的事情，就是从用户输入和数据库中获取数据，并拼接字符串生成文本。后来后端程序开始演化得越来越复杂，单单一层View已经不适应了。由于需要把逻辑从View中分割开来，后端程序开始走上客户端程序走过的路，进行MVC的分离。于是，负责路由和业务逻辑处理的部分变成了Controller，负责数据处理和持久化的部分变成了Model。</p>
<p>虽然后端程序也是做了MVC的拆分，但是它跟客户端的MVC其实是不同的。<br>在客户端里，Controller把View和Model分离开来，实现View和Model的解耦合。View上的变化，通过Controller传递给Model，然后再将Model最新的数据通过Controller传递回View。View：Controller：Model的比例通常是N：1：N，其中每个View基本对应一个Model。</p>
<p>然而，在后端程序里面，View和Model通常没有很强的对应关系。一般意义上的CRUD，基本上是Controller（业务逻辑）围绕着Model（数据层）在转。View扮演的往往是跑龙套的角色。</p>
<h2 id="还需要V层吗"><a href="#还需要V层吗" class="headerlink" title="还需要V层吗"></a>还需要V层吗</h2><p>在客户端MVC中，View扮演的是跟其他二者三足鼎立的角色。用户的输入经过View，底层数据的变更通过View反馈给用户。</p>
<p>然而后端MVC中，View的地位摇摇欲坠、可有可无。前文提到，Controller绑定在路由上，接收请求；Controller渲染模板，发送响应。跟客户端不同的是，Controller只有在渲染模板时才用上View。View的戏份一下子被砍掉了一半。祸不单行，Controller并不一定需要渲染模板来发送响应，它可能直接就重定向了；或者更常见的是，Controller直接把一个对象JSON化，并把它响应给用户。这么一来，View的戏份还剩多少？</p>
<p>有些后端框架提供了JSON格式的模板，多多少少试图挽救View的没落地位。可惜并没有什么用。<br>过去，View通常由三部分组成：html代码，控制流程语句，渲染时的上下文。如果提供的是JSON格式的模板，那么View的前两部分基本不需要了，只需要渲染时的上下文。可是这么一来，为什么我还需要渲染一个JSON模板，直接用上下文的数据创建出个实例，由它生成JSON字符串，不也行吗？虽然我多了个用于响应的类，但是少了个JSON模板啊，而且说不定就不用给View留个文件夹。</p>
<p>最近我参与开发的几个后端应用，根本没有View的容身之地。所有的响应都是JSON格式，都是由特定的类JSON化出来的。<br>很多情况下，后端应用要么仅仅是大后端系统中的一个组件，要么需要跟多种来源的客户端打交道。通常它们只是作为数据的守护者，API的执行人，仅响应以JSON数据。至于接收者想用这些数据做什么，那是它们的事了。也许是拿来渲染前端页面，也许是保存在客户端的数据库里，也许是拿去进一步分析处理。View已经退化到算不上一个层了。</p>
<h2 id="M负责数据实体还是负责数据的访问"><a href="#M负责数据实体还是负责数据的访问" class="headerlink" title="M负责数据实体还是负责数据的访问"></a>M负责数据实体还是负责数据的访问</h2><p>说完摇摇欲坠的View，接着说地位尴尬的Model。Model是数据的化身，后端开发千变万变，核心都是数据的处理。可以说，Model就是占了个风水宝位。不过在我看来，当前常见的做法——只划分一个Model包——并不够清晰。</p>
<p>以我愚见，后端程序中的Model其实做了两件事。一件事是表示了数据实体，另一件则是负责数据的访问。按照单一职责原则，Model这样一身饰两角是不对的。数据实体是一回事，对应的数据实体的访问是另一件事，两者不能混起来。</p>
<h2 id="C：什么都往里装"><a href="#C：什么都往里装" class="headerlink" title="C：什么都往里装"></a>C：什么都往里装</h2><p>调侃了View和Model，是时候对最后的Controller下手了。相对于View负责展示，Model负责数据，Controller的职责并不清晰。Controller是个筐，什么都可以往里面装。凡是无法区分到View和Model的，都放到Controller里面吧。所以，在MVC中，Controller往往是最臃肿的。</p>
<p>终于有一天，我们下定决心要整治下Controller乱七八糟的环境。一个通常的做法是，把某个路由上Controller的函数，拆分成若干个小函数。这些小函数不绑定路由，纯粹就是业务逻辑的抽象。拆分之后，Controller不再臃肿了，抽象出来的业务逻辑也可以被复用。<br>其实往更深一点思考，也许Controller本来就可以拆成两部分，一部分负责绑定路由，另一部分负责业务逻辑。</p>
<ul>
<li><p>绑定路由的部分，负责解决请求数据的完整性和正确性，及限流、鉴权等操作。在它的眼里，看到的是HTTP报文。</p>
</li>
<li><p>业务逻辑的部分，负责具体业务处理。在它的眼里，看到的是用户的操作。</p>
</li>
</ul>
<p>这样一来，业务逻辑的实现就跟路由绑定解耦合。我们可以给不同的路由提供一样的业务逻辑处理的同时，保持在限流等方面上的区别对待。我们也可以以此解决API设计上的遗留问题——旧的API，就让它们调用到新的业务逻辑上。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://utopia1991.github.io/2016/10/24/mvc/" data-id="ciuovr7ga0000owtdvuu91h4i" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-dust" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/23/dust/" class="article-date">
  <time datetime="2016-10-24T03:27:39.000Z" itemprop="datePublished">2016-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/23/dust/">Dust 模版引擎</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-模版引擎介绍"><a href="#1-模版引擎介绍" class="headerlink" title="1.模版引擎介绍"></a>1.模版引擎介绍</h2><p>在静态页面中，包括已经从后台生成的HTML中，一般很少需要应用到模板，但是随着AJAX技术的发展，不刷新页面而动态更新内容的需求越来越高。为了降低通讯成本，这种通讯技术传输的一般是一个JSON对象，而不是一整串HTML字符串，所以在前端接受JSON数据之后，还要经过处理才能按要求显示在浏览器上。若只是用纯javascript进行拼接处理，将是一个比较繁琐的过程，而且写出来的代码不直观，可读性比较低。比如如果一个JSON对象people是下面这样的：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"title"</span>: <span class="string">"Famous People"</span>,</div><div class="line">    <span class="attr">"names"</span>: [&#123; <span class="attr">"name"</span>: <span class="string">"Larry"</span> &#125;, &#123; <span class="attr">"name"</span>: <span class="string">"Curly"</span> &#125;, &#123; <span class="attr">"name"</span>: <span class="string">"Moe"</span> &#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们要把他渲染成一个HTML列表如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Famous People</div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Larry<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Curly<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Moe<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>使用纯粹的javascript将是这样的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> result = people.title + <span class="string">'\n'</span>;</div><div class="line">result += <span class="string">'&lt;ul&gt;'</span> + <span class="string">'\n'</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; people.names.length; i++) &#123;</div><div class="line"> result += <span class="string">'&lt;li&gt;'</span> + people.names[i].name + <span class="string">'&lt;/li&gt;'</span> + <span class="string">'\n'</span>;</div><div class="line">&#125;</div><div class="line">result += <span class="string">'&lt;/ul&gt;'</span></div></pre></td></tr></table></figure></p>
<p>当然了这只是一个比较简单的例子，而且代码具有专用性且不是最简形式，但是为了兼顾可读性和简介性这样写是比较好的。而使用dust模板将只需要一个模板：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;title&#125;</div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">&#123;#names&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>&#123;~n&#125;</div><div class="line">&#123;/names&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后将people传给编译好的模板则可生成所需要的结果，非常直观。</p>
<h2 id="2-什么是Dust-js"><a href="#2-什么是Dust-js" class="headerlink" title="2.什么是Dust.js"></a>2.什么是Dust.js</h2><p>Dustjs、dust.js或者直接叫Dust，是一种模板，一开始是由Aleksander 编写并于2010发布第一个版本于Github。因为后台编译使用 Node.js 所以延续了在插件名后加.js的传统。Aleksander 很喜欢胡子模板 Mustache 的语法。但是Mustache缺少了Aleksander想要的特性，比如模板块和高性能。<br>从dust.js的导引页面看来，这个模板制作者还是很有诚意的。可惜这个项目已于两年前停止更新，版本停留在0.3.0。好消息是大型职业社交网LinkedIn也了解到了这个模板的优点和潜力，并接手了Dust.js的后续开发，最终出来的就是现在的Dust.js(LinkedIn)，为了简便起见后面继续称之为Dust。经过不断地更新，Dust目前已经到了2.0版本了。</p>
<h2 id="3-Dust在线测试器"><a href="#3-Dust在线测试器" class="headerlink" title="3.Dust在线测试器"></a>3.Dust在线测试器</h2><p>首先要介绍一下Dust项目中的一个在线测试器，在了解Dust语法的同时，在这个测试器上尝试应用学到的语法，既可以验证语法是否正确，也可以加强对语法的记忆。进入测试器后可以见到四个框，从左上、左下、右上、右下分别编号为1、2、3、4。测试时在1号框中填入一个Dust模板，然后2号框将显示该模板编译后的结果，再在3号框填入一个JSON对象，4号框中将显示最终的渲染结果。</p>
<h2 id="4-标签（Tag）"><a href="#4-标签（Tag）" class="headerlink" title="4.标签（Tag）"></a>4.标签（Tag）</h2><p>Dust模板以一种嵌入到HTML中的标签的形式存在。Dust标签使用一对花括号包裹，类似于HTML标签使用一对尖括号包裹：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;name&#125;</div></pre></td></tr></table></figure></p>
<h2 id="5-注释"><a href="#5-注释" class="headerlink" title="5.注释"></a>5.注释</h2><p>以下标签将不会产生任何内容，即可用作注释（感叹后之间）：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;! Comment syntax !&#125;</div></pre></td></tr></table></figure></p>
<h2 id="6-键（Key）"><a href="#6-键（Key）" class="headerlink" title="6.键（Key）"></a>6.键（Key）</h2><p>一般Dust标签的表示只有两种形式，一种是键，另一种是区段。键是一个最简单的Dust标签，其中包含的花括号中的值称之为键，对应于JSON对象的属性名，对应的属性值一般为简单类型，比如字符串，渲染后将直接以属性值代替整个标签。如果搜索不到任何匹配值，则不会返回任何数据。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;name&#125;</div></pre></td></tr></table></figure></p>
<p>在键名后面可以跟随过滤器，使用竖线分隔，一般用于选择处理“&lt;”，“&gt;”等特殊符号的转义：</p>
<ul>
<li>{name|s} 禁用自动转码</li>
<li>{name|h} 强制使用HTML转码</li>
<li>{name|j} 强制使用Javascript转码</li>
<li>{name|u} 使用encodeURI编码</li>
<li>{name|uc} 使用encodeURIComponent编码</li>
<li>{name|js} 将JSON对象转换为字符串</li>
<li>{name|jp} 将JSON 字符串转换为JSON对象</li>
</ul>
<p>过滤器也可以进行组合：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;name|jp|h&#125;</div></pre></td></tr></table></figure></p>
<p>一些特殊字符也可以键的形式直接取值输出：</p>
<ul>
<li>{~n} 换行</li>
<li>{~r} CR换行</li>
<li>{~lb} 左花括号</li>
<li>{~rb} 右花括号</li>
<li>{~s} 空格</li>
</ul>
<h2 id="7-区段（Section）"><a href="#7-区段（Section）" class="headerlink" title="7.区段（Section）"></a>7.区段（Section）</h2><p>以下两个标签及其包裹的部分称之为区段，用于循环显示数据。其中“#”为开始标签，“/”为结束标签，其后的键值同样对应于JSON对象的属性名，对应的属性值一般为数组或单个对象，单个对象将被当做一个只有一个元素的数组来对待。模板会按下标对数组中的每个元素调用一次区段包裹着的模板。上一篇中的例子就是利用了区段来循环输出列表元素。区段有两种形式写法第一种如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#names&#125;....&#123;/names&#125;</div></pre></td></tr></table></figure></p>
<p>第二种形式（自封闭式）如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#names/&#125;</div></pre></td></tr></table></figure></p>
<p>在区段中可以使用两个特殊的键：</p>
<ul>
<li>{$idx} 表示当前迭代的序号（从0开始）</li>
<li>{$len} 表示数组长度</li>
</ul>
<h2 id="8-上下文（Context）"><a href="#8-上下文（Context）" class="headerlink" title="8.上下文（Context）"></a>8.上下文（Context）</h2><p>Dust对键或区段值的查询与javascript中对作用域链中变量值的查询类似，换而言之使用区段时会临时改变当前的上下文。 例如一个嵌套的JSON对象：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    "name": "root",</div><div class="line">      "anotherName": "root2",</div><div class="line">      "A":&#123;</div><div class="line">          "name":"Albert",</div><div class="line">          "B":&#123;</div><div class="line">             "name":"Bob"</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用区段索值：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#A&#125;&#123;name&#125;&#123;/A&#125;</div></pre></td></tr></table></figure></p>
<p>则会得到这个对象的A.name的值：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Albert</div></pre></td></tr></table></figure></p>
<p>因为使用区段时将上下文转移到A属性对应的对象中。而使用以下区段索值：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#A&#125;&#123;anotherName&#125;&#123;/A&#125;</div></pre></td></tr></table></figure></p>
<p>因为在对象A的属性中不存在“anotherName”属性，于是Dust会向上查询A所处的上下文，发现存在“anotherName”属性，于是得到：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root2</div></pre></td></tr></table></figure></p>
<p>若往上查找到JSON对象根部间的所有的上下文均无对应属性时将返回空白，索值不会向下查找。</p>
<h2 id="9-路径（Path）"><a href="#9-路径（Path）" class="headerlink" title="9.路径（Path）"></a>9.路径（Path）</h2><p>若使用不带路径的区段索值，那么相当于从JSON对象的根部开始定位区段上下文。而使用路径可以指定开始搜索的位置。路径使用标志“.”来标记标签，跟javascript语法类似。依然是这个JSON对象：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"root"</span>,</div><div class="line">  <span class="attr">"anotherName"</span>: <span class="string">"root2"</span>,</div><div class="line">  <span class="attr">"A"</span>:&#123;</div><div class="line">      <span class="attr">"name"</span>:<span class="string">"Albert"</span>,</div><div class="line">        <span class="attr">"B"</span>:&#123;</div><div class="line">              <span class="attr">"name"</span>:<span class="string">"Bob"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>若我们需要取A属性下的B属性的name则可以表达成这样：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;A.B.name&#125;</div></pre></td></tr></table></figure></p>
<p>或者使用路径标记区块：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#A.B&#125;&#123;name&#125;&#123;/A.B&#125;</div></pre></td></tr></table></figure></p>
<p>或者使用单个“.”表示当前上下文对象（当前为字符串）：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#A.B.name&#125;&#123;.&#125;&#123;/A.B.name&#125;</div></pre></td></tr></table></figure>
<p>规定路径后，首先在指定的上下文进行查找name的值，找不到时不会向上追溯，而是从根部开始查找。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#A.B&#125;&#123;A.name&#125;&#123;/A.B&#125;</div></pre></td></tr></table></figure></p>
<p>上面这个模板将会在A.B中搜索A，因为B并无A属性，所以从JSON对象根部开始找到A属性，从而找到A.name，返回“Albert”，若从根部也无法找到，则返回空白。</p>
<h2 id="10-修改上下文"><a href="#10-修改上下文" class="headerlink" title="10.修改上下文"></a>10.修改上下文</h2><p>我们也可以在一定程度上修改上下文的关系。通过使用冒号“:”可以用冒号后面的键值代替前面的键值的父级上下文：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#A:A2&#125; ... &#123;/A&#125;</div></pre></td></tr></table></figure></p>
<p>以上这个区段会屏蔽掉A的父级上下文，临时将A2作为A的父级上下文，即在A中找不到目标时不会往上回溯，而去搜索A2下的属性。</p>
<h2 id="11-区段参数"><a href="#11-区段参数" class="headerlink" title="11.区段参数"></a>11.区段参数</h2><p>在区段中可以设置参数：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;#A.B foo="Hi" bar=" Good to see you"&#125;</div><div class="line">    &#123;foo&#125; &#123;name&#125; &#123;bar&#125;</div><div class="line">&#123;/A.B&#125;</div></pre></td></tr></table></figure></p>
<p>模板会将参数值替代键值标签，结果为：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hi Bob Good to see you</div></pre></td></tr></table></figure></p>
<p>参数也可以是键名，但是赋值时的上下文在区段之外：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;#A.B foo=A.name bar=anotherName&#125;</div><div class="line">    &#123;foo&#125; &#123;name&#125; &#123;bar&#125;</div><div class="line">&#123;/A.B&#125;</div></pre></td></tr></table></figure>
<h2 id="12-逻辑区段"><a href="#12-逻辑区段" class="headerlink" title="12.逻辑区段"></a>12.逻辑区段</h2><h3 id="标签"><a href="#标签" class="headerlink" title="?标签"></a>?标签</h3><p>用?来代替区段标签中的#时，仅当name的值为真时，才执行区段主体部分。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;?name&#125; body &#123;/name&#125;</div></pre></td></tr></table></figure></p>
<h3 id="标签-1"><a href="#标签-1" class="headerlink" title="^标签"></a>^标签</h3><p>用^来代替#时，仅当name的值为假时，才执行区段主体部分。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;^name&#125; body &#123;/name&#125;</div></pre></td></tr></table></figure></p>
<h3 id="else-标签"><a href="#else-标签" class="headerlink" title="{:else}标签"></a>{:else}标签</h3><p>当一个区段标签（包括#、?、^、以及逻辑标签等）的值为假时，若区段主体中包含{:else}标签，则执行{:else}标签以及区段结束标签之间的内容，否则忽略这些内容。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">    &#123;#friends&#125;</div><div class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;name&#125;, &#123;age&#125;&#123;~n&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    &#123;:else&#125;</div><div class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You have no friends!<span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    &#123;/friends&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>若friend为空，则仅仅输出：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>You have no friends!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="值的真假"><a href="#值的真假" class="headerlink" title="值的真假"></a>值的真假</h3><p>在区段中判断标签的真假的方法与Javascript本身稍有不同，Dust将以下值判断为假：</p>
<ul>
<li>空字符串’’、””</li>
<li>布尔false</li>
<li>null</li>
<li>undefined</li>
<li>空列表[]</li>
</ul>
<p>其余值均为真值，包括数字“0”，空对象{}。</p>
<h3 id="拆分（Partials）"><a href="#拆分（Partials）" class="headerlink" title="拆分（Partials）"></a>拆分（Partials）</h3><p>拆分是一种将重复使用的模板抽取出来，并在使用到这段模板的模板中直接导入该模板，避免重复劳动的方法。在服务端，一个名为“xxx”的Dust模板通常通常保存在一个名为xxx.dust的模板文件中。我们可以利用模板名来在模板中插入一段来自其他模版文件的模板：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&gt;name /&#125;</div></pre></td></tr></table></figure></p>
<p>以上是一个自封闭的区段标签，代表将name.dust中的模版插入到当前位置。若文件包含路径，则用双引号包裹：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&gt;”dust/name” /&#125;</div></pre></td></tr></table></figure></p>
<p>标签中也可以填写参数：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&gt;”dust/name” foo=”Hello” bar=” World”/&#125;</div></pre></td></tr></table></figure></p>
<p>甚至可以使用动态路径：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&gt;”dust/&#123;pathName&#125;” /&#125;</div></pre></td></tr></table></figure></p>
<h3 id="区块（Blocks）"><a href="#区块（Blocks）" class="headerlink" title="区块（Blocks）"></a>区块（Blocks）</h3><p>通过拆分可以重用一个模版，但是用这种方法来派生模版有一个缺点，就是你需要记得需要在什么位置插入哪个模版，并且对每一个派生出来的模版都要重新布局一次。区块可以解决这个问题，在父模板中使用区块可以方便地在子模板中替换区块中的内容。区块也是一种特殊的区段，定义方法如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;+name /&#125;</div></pre></td></tr></table></figure></p>
<p>或者在区段中填写默认内容，当区块没有被替换时，将显示默认内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;+name&#125;default Content&#123;/name&#125;</div></pre></td></tr></table></figure></p>
<p>使用区块替换需要在子模板中使用拆分区段（&gt;）导入父模板，并使用替换区段（&lt;）进行替换：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;&gt;father/&#125;</div><div class="line">&#123;<span class="tag">&lt;<span class="name">name&#125;Content&#123;</span>/<span class="attr">name</span>&#125;</span></div></pre></td></tr></table></figure></p>
<p>比如一个父模板可以写成这样：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;+pageHeader&#125;PayPal&#123;/pageHeader&#125;<span class="tag">&lt;/<span class="name">h</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bodyContent"</span>&gt;</span></div><div class="line">    &#123;+bodyContent/&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span></div><div class="line">    &#123;+pageFooter&#125;Contact Us &#123;/pageFooter&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后保存为shared/base_template.dust文件，然后定义子模板：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;! 首先导入父模板 !&#125;</div><div class="line">&#123;&gt;"shared/base_template"/&#125;</div><div class="line">&#123;! 然后定义对应的部分 !&#125;</div><div class="line">&#123;&lt;bodyContent&#125;</div><div class="line">&lt;p&gt;These are your current settings:&lt;/p&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">  &lt;li&gt;xxxx&lt;/li&gt;</div><div class="line">  &lt;li&gt;yyy&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&#123;/bodyContent&#125;</div><div class="line">&#123;&lt;pageFooter&#125;</div><div class="line">  &lt;hr&gt;</div><div class="line">  &lt;a href="/contactUs"&gt;About Us&lt;/a&gt; |</div><div class="line">  &lt;a href="/contactUs"&gt;Contact Us&lt;/a&gt;</div><div class="line">&#123;/pageFooter&#125;</div></pre></td></tr></table></figure></p>
<h2 id="13-编译"><a href="#13-编译" class="headerlink" title="13.编译"></a>13.编译</h2><p>之前也介绍过，Dust是编译型模板，意思则是若需应用模板，首先要将模板可执行化，即将模板变成可执行的代码。如果你使用过Dust测试器，那么你会发现在你输入模板后，会在2号框中显示一个函数定义，那就是编译生成的代码。使用编译型模板有一个好处，就是当模板编译好之后，若需要重复使用模板，不需要每次都对模板重新进行分析，加快模板解析的速度，而且，模板可以预先编译好保存在服务器，甚至让前端连第一次编译的时间都节省了。<br>因此Dust库有两种发行版本：</p>
<ul>
<li>dust-core-2.0.2.js</li>
<li>dust-full-2.0.2.js<br>前者为核心（Core）版本，其只包含模板解析的相关代码，大小只有十几k，而完全版（Full）则包含Dust的所有代码，包括编译器，大小有一百多k。对于不需要在前端进行编译的项目，仅仅需要使用核心版本即可，这也是速度比较快的做法。但是对于需要在前端动态编译的项目，则只能使用包含编译器的完全版。<br>编译模板的方法很简单，使用完全版的dust.compile()方法：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> compiled = dust.compile(<span class="string">"Hello &#123;name&#125;!"</span>, <span class="string">"intro"</span>);</div></pre></td></tr></table></figure>
<p>其中第一个参数为模板字符串，第二个参数为模板名，函数将返回包含编译好的可执行代码的字符串。这个操作不会注册这个模板，仅进行编译，此时仍不可通过模板名来调用这段代码。</p>
<h2 id="14-注册"><a href="#14-注册" class="headerlink" title="14.注册"></a>14.注册</h2><p>如果直接执行一遍compiled中的代码，则模板会按之前指定的名字注册到dust，从而可以通过模板名来调用该模板。但若compiled代码未被执行过，则需要在渲染前手动将其注册到dust中，注册的方法很简单：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dust.loadSource(compiled);</div></pre></td></tr></table></figure></p>
<h2 id="15-渲染"><a href="#15-渲染" class="headerlink" title="15.渲染"></a>15.渲染</h2><p>通过编译注册可以让多套模板处于就绪状态，对于这些模板，我们可以直接用它将JSON对象渲染成HTML文本，通过调用dust.render()方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dust.render(<span class="string">"intro"</span>, &#123;<span class="attr">name</span>: <span class="string">"Fred"</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, out</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(out);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这个方法接受3个参数，第一个为模板名，第二个为JSON对象，第三个是一个接受两个参数的回调函数。执行这个方法后Dust会使用注册好的对应模板对JSON对象进行处理，得出一个渲染结果字符串，然后调用回调函数，其中第一个参数包含了在处理过程中出现的错误信息，第二个参数就是渲染结果字符串。一般会在回调函数中将渲染结果插入到当前的DOM结构中，以便在浏览器中显示渲染结果。</p>
<h2 id="16-区块和拆分"><a href="#16-区块和拆分" class="headerlink" title="16.区块和拆分"></a>16.区块和拆分</h2><p>一般使用文件来保存模板并且使用区块和拆分是让Dust作为服务端模板时应用的技术，因为在客户端Javascript中无法很方便地对分布式文件进行操作。但是我们可以通过在本地部署模板数据，编译成可执行代码并用一个js文件来保存的方式来使用区块和拆分。<br>若在Linux平台则直接在终端安装npm和dust并使用dustc命令编译成代码，得到js文件。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install dustjs-linkedin</div><div class="line">$ dustc input.dust output.js</div></pre></td></tr></table></figure></p>
<p>或者在js引擎中使用dust.compile()，将模板复制到第一个参数，指定第二参数为其不带后缀的文件名，并将结果输出到js文件。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> output1 = dust.compile(partialStr, <span class="string">"partial"</span>);</div><div class="line"><span class="keyword">var</span> output2 = dust.compile(baseStr, <span class="string">"base"</span>);</div><div class="line"><span class="keyword">var</span> output3 = dust.compile(childStr, <span class="string">"child"</span>);</div></pre></td></tr></table></figure></p>
<p>最后在HTML中导入所有生成的js文件即可使用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"partial.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"base.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"child.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>注意此时不再需要使用dust.loadSource()来注册，因为script标签将js文件执行了一次，已经将模板注册好了。此时已可使用dust.render()进行渲染。</p>
<h4 id="ps：这些都是因为工作开发中用到了dust，在国内很少开发人员用到这种引擎，而公司是一家外企，有幸可以用上这个，这只是些基础，会这些也大概会百分之七八十了，还有不能的，可以google下dust，查看官方文档，或者关注我的GitHub-里面有dust的教学"><a href="#ps：这些都是因为工作开发中用到了dust，在国内很少开发人员用到这种引擎，而公司是一家外企，有幸可以用上这个，这只是些基础，会这些也大概会百分之七八十了，还有不能的，可以google下dust，查看官方文档，或者关注我的GitHub-里面有dust的教学" class="headerlink" title="ps：这些都是因为工作开发中用到了dust，在国内很少开发人员用到这种引擎，而公司是一家外企，有幸可以用上这个，这只是些基础，会这些也大概会百分之七八十了，还有不能的，可以google下dust，查看官方文档，或者关注我的GitHub,里面有dust的教学"></a>ps：这些都是因为工作开发中用到了dust，在国内很少开发人员用到这种引擎，而公司是一家外企，有幸可以用上这个，这只是些基础，会这些也大概会百分之七八十了，还有不能的，可以google下dust，查看官方文档，或者关注我的<a href="https://github.com/utopia1991" target="_blank" rel="external">GitHub</a>,里面有dust的教学</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://utopia1991.github.io/2016/10/23/dust/" data-id="ciujicu0a0001jjtdklwehuyq" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/23/markdown/" class="article-date">
  <time datetime="2016-10-24T03:21:29.000Z" itemprop="datePublished">2016-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/23/markdown/">Markdown 编辑器语法指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>如果你只想高亮语句中的某个函数名或关键字，可以使用 <code>function_name()</code> 实现</p>
<p>通常编辑器根据代码片段适配合适的高亮方法，但你也可以用 3个’ ` ‘ 包裹一段代码，并指定一种语言<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    alert(<span class="string">'hello world'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>支持的语言：actionscript, apache, bash, clojure, cmake, coffeescript, cpp, cs, css, d, delphi, django, erlang, go, haskell, html, http, ini, java, javascript, json, lisp, lua, markdown, matlab, nginx, objectivec, perl, php, python, r, ruby, scala, smalltalk, sql, tex, vbscript, xml</p>
<p>也可以使用 4 空格缩进，再贴上代码，实现相同的的效果<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def g(x):</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> range(x, <span class="number">0</span>, <span class="number">-1</span>)</div><div class="line"><span class="keyword">yield</span> <span class="keyword">from</span> range(x)</div></pre></td></tr></table></figure></p>
<h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><p>文章内容较多时，可以用标题分段：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">标题1</div><div class="line">======</div><div class="line"></div><div class="line">标题2</div><div class="line">-----</div><div class="line"></div><div class="line">## 大标题 ##</div><div class="line">### 小标题 ###</div></pre></td></tr></table></figure></p>
<h2 id="粗斜体"><a href="#粗斜体" class="headerlink" title="粗斜体"></a>粗斜体</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">*斜体文本*    _斜体文本_</div><div class="line">**粗体文本**    __粗体文本__</div><div class="line">***粗斜体文本***    ___粗斜体文本___</div></pre></td></tr></table></figure>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><h3 id="常用链接方法"><a href="#常用链接方法" class="headerlink" title="常用链接方法"></a>常用链接方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">文字链接 [链接名称](http:<span class="comment">//链接网址)</span></div><div class="line">网址链接 &lt;http:<span class="comment">//链接网址&gt;</span></div></pre></td></tr></table></figure>
<h3 id="高级链接技巧"><a href="#高级链接技巧" class="headerlink" title="高级链接技巧"></a>高级链接技巧</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">这个链接用 <span class="number">1</span> 作为网址变量 [Google][<span class="number">1</span>].</div><div class="line">这个链接用 yahoo 作为网址变量 [Yahoo!][yahoo].</div><div class="line">然后在文档的结尾为变量赋值（网址）</div><div class="line"></div><div class="line">  [<span class="number">1</span>]: http:<span class="comment">//www.google.com/</span></div><div class="line">  [yahoo]: http:<span class="comment">//www.yahoo.com/</span></div></pre></td></tr></table></figure>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><h3 id="普通无序列表"><a href="#普通无序列表" class="headerlink" title="普通无序列表"></a>普通无序列表</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- 列表文本前使用 [减号+空格]</div><div class="line">+ 列表文本前使用 [加号+空格]</div><div class="line">* 列表文本前使用 [星号+空格]</div></pre></td></tr></table></figure>
<h3 id="普通有序列表"><a href="#普通有序列表" class="headerlink" title="普通有序列表"></a>普通有序列表</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span> 列表前使用 [数字+空格]</div><div class="line"><span class="number">2.</span> 我们会自动帮你添加数字</div><div class="line"><span class="number">7.</span> 不用担心数字不对，显示的时候我们会自动把这行的 <span class="number">7</span> 纠正为 <span class="number">3</span></div></pre></td></tr></table></figure>
<h3 id="列表嵌套"><a href="#列表嵌套" class="headerlink" title="列表嵌套"></a>列表嵌套</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span> 列出所有元素：</div><div class="line">    - 无序列表元素 A</div><div class="line">        <span class="number">1.</span> 元素 A 的有序子列表</div><div class="line">    - 前面加四个空格</div><div class="line"><span class="number">2.</span> 列表里的多段换行：</div><div class="line">    前面必须加四个空格，</div><div class="line">    这样换行，整体的格式不会乱</div><div class="line"><span class="number">3.</span> 列表里引用：</div><div class="line">    &gt; 前面空一行</div><div class="line">    &gt; 仍然需要在 &gt;  前面加四个空格</div></pre></td></tr></table></figure>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><h3 id="普通引用"><a href="#普通引用" class="headerlink" title="普通引用"></a>普通引用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; 引用文本前使用 [大于号+空格]</div><div class="line">&gt; 折行可以不加，新起一行都要加上哦</div></pre></td></tr></table></figure>
<h3 id="引用里嵌套引用"><a href="#引用里嵌套引用" class="headerlink" title="引用里嵌套引用"></a>引用里嵌套引用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; 最外层引用</div><div class="line">&gt; &gt; 多一个 &gt; 嵌套一层引用</div><div class="line">&gt; &gt; &gt; 可以嵌套很多层</div></pre></td></tr></table></figure>
<h3 id="引用里嵌套列表"><a href="#引用里嵌套列表" class="headerlink" title="引用里嵌套列表"></a>引用里嵌套列表</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; - 这是引用里嵌套的一个列表</div><div class="line">&gt; - 还可以有子列表</div><div class="line">&gt;     * 子列表需要从 - 之后延后四个空格开始</div></pre></td></tr></table></figure>
<h3 id="引用里嵌套代码块"><a href="#引用里嵌套代码块" class="headerlink" title="引用里嵌套代码块"></a>引用里嵌套代码块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;     同样的，在前面加四个空格形成代码块</div><div class="line">&gt; 或者使用 <span class="string">``</span><span class="string">` 形成代码块</span></div></pre></td></tr></table></figure>
<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p>跟链接的方法区别在于前面加了个感叹号 !，这样是不是觉得好记多了呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">![图片名称](http:<span class="comment">//图片网址)</span></div></pre></td></tr></table></figure></p>
<p>当然，你也可以像网址那样对图片网址使用变量<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">这个链接用 <span class="number">1</span> 作为网址变量 [Google][<span class="number">1</span>].</div><div class="line">然后在文档的结尾位变量赋值（网址）</div><div class="line"> [<span class="number">1</span>]: http:<span class="comment">//www.google.com/logo.png</span></div></pre></td></tr></table></figure></p>
<p>也可以使用 HTML 的图片语法来自定义图片的宽高大小<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;img src=<span class="string">"htt://example.com/sample.png"</span> width=<span class="string">"400"</span> height=<span class="string">"100"</span>&gt;</div></pre></td></tr></table></figure></p>
<h2 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h2><p>如果另起一行，只需在当前行结尾加 2 个空格<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">在当前行的结尾加 <span class="number">2</span> 个空格  </div><div class="line">这行就会新起一行</div></pre></td></tr></table></figure></p>
<p>如果是要起一个新段落，只需要空出一行即可。</p>
<h2 id="分隔符"><a href="#分隔符" class="headerlink" title="分隔符"></a>分隔符</h2><p>如果你有写分割线的习惯，可以新起一行输入三个减号-。当前后都有段落时，请空出一行：<br>这行就会新起一行<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">前面的段落</div><div class="line">---</div><div class="line">后面的段落</div></pre></td></tr></table></figure></p>
<h2 id="高级技巧"><a href="#高级技巧" class="headerlink" title="高级技巧"></a>高级技巧</h2><h3 id="行内-HTML-元素"><a href="#行内-HTML-元素" class="headerlink" title="行内 HTML 元素"></a>行内 HTML 元素</h3><p>目前只支持部分段内 HTML 元素效果，包括<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;kdb&gt; &lt;b&gt; &lt;i&gt; &lt;em&gt; &lt;sup&gt; &lt;sub&gt; &lt;br&gt;</div></pre></td></tr></table></figure></p>
<p>例如：</p>
<h4 id="键位显示"><a href="#键位显示" class="headerlink" title="键位显示"></a>键位显示</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">使用 &lt;kbd&gt;Ctrl&lt;kbd&gt;+&lt;kbd&gt;Alt&lt;kbd&gt;+&lt;kbd&gt;Del&lt;kbd&gt; 重启电脑</div></pre></td></tr></table></figure>
<h4 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">使用 &lt;pre&gt;<span class="xml"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span> 元素同样可以形成代码块</div></pre></td></tr></table></figure>
<h4 id="粗斜体-1"><a href="#粗斜体-1" class="headerlink" title="粗斜体"></a>粗斜体</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;b&gt; Markdown 在此处同样适用，如 *加粗* <span class="xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="符号转义"><a href="#符号转义" class="headerlink" title="符号转义"></a>符号转义</h4><p>如果你的描述中需要用到 markdown 的符号，比如 <em> # * 等，但又不想它被转义，这时候可以在这些符号前加反斜杠，如 \</em> # * 进行避免。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\_不想这里的文本变斜体\_</div><div class="line">\*\*不想这里的文本被加粗\*\*</div></pre></td></tr></table></figure></p>
<h4 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h4><p>支持 jsfiddle、gist、runjs、优酷视频，直接填写 url，在其之后会自动添加预览点击会展开相关内容。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">http:<span class="comment">//&#123;url_of_the_fiddle&#125;/embedded/[&#123;tabs&#125;/[&#123;style&#125;]]/</span></div><div class="line">https:<span class="comment">//gist.github.com/&#123;gist_id&#125;</span></div><div class="line">http:<span class="comment">//runjs.cn/detail/&#123;id&#125;</span></div><div class="line">http:<span class="comment">//v.youku.com/v_show/id_&#123;video_id&#125;.html</span></div></pre></td></tr></table></figure></p>
<h4 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h4><p>当你需要在编辑器中插入数学公式时，可以使用两个美元符 $$ 包裹 TeX 或 LaTeX 格式的数学公式来实现。提交后，问答和文章页会根据需要加载 Mathjax 对数学公式进行渲染。如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$$ x = &#123;-b \pm \sqrt&#123;b^<span class="number">2</span><span class="number">-4</span>ac&#125; \over <span class="number">2</span>a&#125;. $$</div><div class="line">$$</div><div class="line">x \href&#123;why-equal.html&#125;&#123;=&#125; y^<span class="number">2</span> + <span class="number">1</span></div><div class="line">$$</div></pre></td></tr></table></figure></p>
<p>同时也支持 HTML 属性，如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$$ (x+<span class="number">1</span>)^<span class="number">2</span> = \<span class="class"><span class="keyword">class</span></span>&#123;hidden&#125;&#123;(x+<span class="number">1</span>)(x+<span class="number">1</span>)&#125; $$</div><div class="line">$$</div><div class="line">(x+<span class="number">1</span>)^<span class="number">2</span> = \cssId&#123;step1&#125;&#123;\style&#123;<span class="attr">visibility</span>:hidden&#125;&#123;(x+<span class="number">1</span>)(x+<span class="number">1</span>)&#125;&#125;</div><div class="line">$$</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://utopia1991.github.io/2016/10/23/markdown/" data-id="ciunedcsd0000vbtdq488kpzb" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-coffee" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/23/coffee/" class="article-date">
  <time datetime="2016-10-24T01:38:40.000Z" itemprop="datePublished">2016-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/23/coffee/">Coffeescript 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-coffee注释："><a href="#1-coffee注释：" class="headerlink" title="1.coffee注释："></a>1.coffee注释：</h2><p>注释是用 ‘ # ‘ 来标记的。coffee不需要 ‘ ; ‘ 作为结束标签。有时候你想把整块的注释传给生成的 JavaScript. 使用“###”比如在文件顶部嵌入协议. 块级的注释, 仿照了块级字符串的语法, 将会在生成的代码当中保留.</p>
<p>js:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">     SkinnyMochaHalfCaffScript Compiler v1.0</div><div class="line">     Released under the MIT License</div><div class="line">*/</div></pre></td></tr></table></figure></p>
<p>coffee:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># SkinnyMochaHalfCaffScript Compiler v1.0</span></div><div class="line"><span class="comment"># Released under the MIT License</span></div></pre></td></tr></table></figure></p>
<h2 id="2-创建对象："><a href="#2-创建对象：" class="headerlink" title="2.创建对象："></a>2.创建对象：</h2><p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">obj = &#123;</div><div class="line">    Name: <span class="string">"Bevis"</span>,</div><div class="line">    Sex: <span class="string">"male"</span></div><div class="line">&#125;</div><div class="line">e = obj.Name</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">obj =</div><div class="line">    Name: <span class="string">"Bevis"</span></div><div class="line">    Sex: <span class="string">"male"</span></div><div class="line">e = obj.Name</div></pre></td></tr></table></figure></p>
<h2 id="3-创建数组"><a href="#3-创建数组" class="headerlink" title="3.创建数组"></a>3.创建数组</h2><p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = [</div><div class="line">    3,45,457,3242</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr =［</div><div class="line">    3,45,457,3242</div><div class="line">］</div></pre></td></tr></table></figure></p>
<h2 id="4-创建嵌套对象（对象的’-’是去掉不写）"><a href="#4-创建嵌套对象（对象的’-’是去掉不写）" class="headerlink" title="4.创建嵌套对象（对象的’{}’是去掉不写）"></a>4.创建嵌套对象（对象的’{}’是去掉不写）</h2><p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">school =</div><div class="line">    teacher:</div><div class="line">    name:<span class="string">'utopia'</span></div><div class="line">    sex:<span class="string">'male'</span></div><div class="line">    student:</div><div class="line">    name:<span class="string">'bevis'</span></div><div class="line">    sex:<span class="string">'male'</span></div><div class="line">a = school.teacher.name</div></pre></td></tr></table></figure></p>
<h2 id="5-coffee可以与jquery结合（jquery的dom查询的方法和jquery原先一样）"><a href="#5-coffee可以与jquery结合（jquery的dom查询的方法和jquery原先一样）" class="headerlink" title="5.coffee可以与jquery结合（jquery的dom查询的方法和jquery原先一样）"></a>5.coffee可以与jquery结合（jquery的dom查询的方法和jquery原先一样）</h2><p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ <span class="string">'.demo1'</span>.addClass <span class="string">'demo2'</span></div><div class="line">$ <span class="string">'body'</span>.click (e) -&gt;</div><div class="line">    $ <span class="string">'.box'</span></div><div class="line">        .fadeIn <span class="string">'fast'</span></div><div class="line">        .addClass <span class="string">'.active'</span></div><div class="line">    .css <span class="string">'background'</span>, <span class="string">'white'</span></div></pre></td></tr></table></figure></p>
<h2 id="6-if-else语句"><a href="#6-if-else语句" class="headerlink" title="6.if else语句"></a>6.if else语句</h2><h3 id="第1种方式：then后参数是为true，else后参数是false"><a href="#第1种方式：then后参数是为true，else后参数是false" class="headerlink" title="第1种方式：then后参数是为true，else后参数是false"></a>第1种方式：then后参数是为true，else后参数是false</h3><p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">singing = <span class="literal">true</span></div><div class="line">mood = <span class="keyword">if</span> singing <span class="keyword">then</span> <span class="string">'happy'</span> <span class="keyword">else</span> <span class="string">'sad'</span></div></pre></td></tr></table></figure></p>
<h3 id="第2种方式-就是原始的if-else，但是不用’-’"><a href="#第2种方式-就是原始的if-else，但是不用’-’" class="headerlink" title="第2种方式,就是原始的if else，但是不用’{}’"></a>第2种方式,就是原始的if else，但是不用’{}’</h3><p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">high = <span class="literal">true</span></div><div class="line"><span class="keyword">if</span> high</div><div class="line">    ...</div><div class="line"><span class="keyword">else</span></div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p>也可以把条件里面的运行函数单独写成方法</p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">one = -&gt;</div><div class="line">    console.log 1</div><div class="line">two = -&gt;</div><div class="line">    console.log 2</div><div class="line"><span class="keyword">if</span> high</div><div class="line">    one()</div><div class="line"><span class="keyword">else</span></div><div class="line">    two()</div></pre></td></tr></table></figure></p>
<h2 id="7-变参-splats-…"><a href="#7-变参-splats-…" class="headerlink" title="7.变参(splats)…"></a>7.变参(splats)…</h2><p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">gold = silver = rest = <span class="string">"unknown"</span></div><div class="line">awardMedals = (first, second, others) -&gt;</div><div class="line">    gold = first</div><div class="line">    silver = second</div><div class="line">    rest = others</div><div class="line">contenders = [</div><div class="line">    <span class="string">"Michael Phelps"</span></div><div class="line">    <span class="string">"Liu Xiang"</span></div><div class="line">    <span class="string">"Yao Ming"</span></div><div class="line">]</div><div class="line">awardMedals contenders...</div><div class="line">console.log gold</div><div class="line">console.log silver</div><div class="line">console.log rest</div></pre></td></tr></table></figure></p>
<h2 id="8-循环"><a href="#8-循环" class="headerlink" title="8.循环"></a>8.循环</h2><p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">foods = [<span class="string">'toast'</span>,<span class="string">'cheese'</span>,<span class="string">'wine'</span>]</div><div class="line">an = (food <span class="keyword">for</span> food <span class="keyword">in</span> foods)</div><div class="line">console.log an</div><div class="line">student = &#123;</div><div class="line">    excellentWork:<span class="literal">false</span></div><div class="line">    okayStuff:<span class="literal">true</span></div><div class="line">    triedHard:<span class="literal">false</span></div><div class="line">&#125;</div><div class="line">grade = (a) -&gt;  <span class="comment">#function = (x) -&gt; x为代入的参数</span></div><div class="line"><span class="keyword">if</span> a.excellentWork</div><div class="line">    <span class="string">"A+"</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> a.okayStuff</div><div class="line">    <span class="keyword">if</span> a.triedHard <span class="keyword">then</span> <span class="string">"B"</span> <span class="keyword">else</span> <span class="string">"B-"</span></div><div class="line"><span class="keyword">else</span></div><div class="line">    <span class="string">"C"</span></div><div class="line">console.log grade(student)</div></pre></td></tr></table></figure></p>
<h2 id="9-操作符"><a href="#9-操作符" class="headerlink" title="9.操作符"></a>9.操作符</h2><ul>
<li>CoffeeScript 会把 == 编译为 ===, 把 != 变异为 !==. 此外, is 编译我 ===, 而 isn’t 编译为 !==</li>
<li>not 可以作为 ! 使用.</li>
<li>逻辑操作方面, and 编译为 &amp;&amp;, 而 or 编译为 ||</li>
<li>在 while, if/else, switch/when 的语句当中, then 可以被用来分隔判断条件跟表达式, 这样就不用强制写换行或者分号了</li>
<li>unless 可以认为是 if 相反的版本.</li>
<li>this.property 简短的写法可以用 @property</li>
</ul>
<p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (ignition === <span class="literal">true</span>) &#123;</div><div class="line">  launch();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">launch() <span class="keyword">if</span> ignition ison</div></pre></td></tr></table></figure></p>
<p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (band !== SpinalTap) &#123;</div><div class="line">    volume = 10;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">volume = 10<span class="keyword">if</span> band isnt SpinalTap</div></pre></td></tr></table></figure></p>
<p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (answer !== <span class="literal">false</span>) &#123;</div><div class="line">     <span class="built_in">let</span>TheWildRumpusBegin();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span>TheWildRumpusBegin() unless answer isno</div></pre></td></tr></table></figure></p>
<p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (car.speed &lt; <span class="built_in">limit</span>) &#123;</div><div class="line">    accelerate();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> car.speed &lt; <span class="built_in">limit</span> <span class="keyword">then</span> accelerate()</div></pre></td></tr></table></figure></p>
<p>ps：这个使用then因为前面的是一个表达式，加入前面只是一个正确判断则不要写then，加入为表达式防止表达式混淆，用then</p>
<p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (pick === 47 || pick === 92 || pick === 13) &#123;</div><div class="line">  winner = <span class="literal">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">winner = yes <span class="keyword">if</span> pick <span class="keyword">in</span> [47, 92, 13]</div></pre></td></tr></table></figure></p>
<p>ps：if pick in [47, 92, 13]这里 in 的意思是是否包含里面元素中的一个</p>
<p>extends 操作符可以用来恰当地定义任何一对构造函数的原型链; 用 :: 可以快速访问对象的原型; super() 可以编译为一个父类上同名方法的调用.</p>
<p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String.prototype.dasherize = <span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">     returnthis.replace(/_/g, <span class="string">"-"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String::dasherize = -&gt;this.replace /_/g, <span class="string">"-"</span></div></pre></td></tr></table></figure></p>
<p>##10.解构赋值</p>
<p>CoffeeScript 实现 ECMAScript Harmony 的提议 解构赋值 语法, 这样从复杂的数组和对象展开数据会更方便一些. 当你把数组或者对象的字面量赋值到一个变量时, CoffeeScript 把等式两边都解开配对, 把右边的值赋值给左边的变量. 最简单的例子, 可以用来并行赋值:</p>
<p>js：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var theBait, theSwitch, _ref;</div><div class="line">theBait = 1000;</div><div class="line">theSwitch = 0;</div><div class="line">_ref = [theSwitch, theBait], theBait = _ref[0], theSwitch = _ref[1];</div></pre></td></tr></table></figure></p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">theBait   = 1000</div><div class="line">theSwitch = 0</div><div class="line">[theBait, theSwitch] = [theSwitch, theBait]</div></pre></td></tr></table></figure></p>
<p>这样theBait的值就为0，theSwitch的值为1000了，就是一一对应的关系</p>
<p>##11.Switch语句</p>
<p>js：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">switch (day) &#123;</div><div class="line">  <span class="keyword">case</span><span class="string">"Mon"</span>:</div><div class="line">    go(work);</div><div class="line">    <span class="built_in">break</span>;</div><div class="line">  <span class="keyword">case</span><span class="string">"Tue"</span>:</div><div class="line">    go(relax);</div><div class="line">    <span class="built_in">break</span>;</div><div class="line">  <span class="keyword">case</span><span class="string">"Thu"</span>:</div><div class="line">    go(iceFishing);</div><div class="line">    <span class="built_in">break</span>;</div><div class="line">  <span class="keyword">case</span><span class="string">"Fri"</span>:</div><div class="line">  <span class="keyword">case</span><span class="string">"Sat"</span>:</div><div class="line">    <span class="keyword">if</span> (day === bingoDay) &#123;</div><div class="line">      go(bingo);</div><div class="line">      go(dancing);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">break</span>;</div><div class="line">  <span class="keyword">case</span><span class="string">"Sun"</span>:</div><div class="line">    go(church);</div><div class="line">    <span class="built_in">break</span>;</div><div class="line">  default:</div><div class="line">    go(work);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>CoffeeScript 支持多行字符串. 行与行会用一个空格拼接, 除非结尾用了反斜杠. 其中缩进会被忽略.</p>
<p>coffee：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">switch day</div><div class="line">when<span class="string">"Mon"</span><span class="keyword">then</span> go work</div><div class="line">  when<span class="string">"Tue"</span><span class="keyword">then</span> go relax</div><div class="line">  when<span class="string">"Thu"</span><span class="keyword">then</span> go iceFishing</div><div class="line">  when<span class="string">"Fri"</span>, <span class="string">"Sat"</span><span class="keyword">if</span> day is bingoDay</div><div class="line">      go bingo</div><div class="line">      go dancing</div><div class="line">  when<span class="string">"Sun"</span><span class="keyword">then</span> go church</div><div class="line">  <span class="keyword">else</span> go work</div></pre></td></tr></table></figure></p>
<p>coffee中switch语句的写法是when … then …，最后一个default用else来替代</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://utopia1991.github.io/2016/10/23/coffee/" data-id="ciujkr9830000nhtdjt5nf8rg" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-eslint" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/21/eslint/" class="article-date">
  <time datetime="2016-10-21T08:56:03.000Z" itemprop="datePublished">2016-10-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/21/eslint/">EsLint入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>官方地址：<a href="http://eslint.org/" target="_blank" rel="external">http://eslint.org/</a><br>EsLint帮助我们检查Javascript编程时的语法错误。比如：在Javascript应用中，你很难找到你漏泄的变量或者方法。EsLint能够帮助我们分析JS代码，找到bug并确保一定程度的JS语法书写的正确性。<br>EsLint是建立在Esprima(ECMAScript解析架构)的基础上的。Esprima支持ES5.1,本身也是用ECMAScript编写的，用于多用途分析。EsLint不但提供一些默认的规则（可扩展），也提供用户自定义规则来约束我们写的Javascript代码。<br>EsLint提供以下支持：</p>
<ul>
<li>ES6AngularJSJSXStyle检查自定义错误和提示<br>EsLint提供以下几种校验：</li>
<li>语法错误校验不重要或丢失的标点符号，如分号没法运行到的代码块（使用过WebStorm的童鞋应该了解）未被使用的参数提醒漏掉的结束符，如}确保样式的统一规则，如sass或者less检查变量的命名</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h3><p>Npm install gulp-eslint –save-dev<br>在你的项目目录下，运行：eslint –init将会产生一个.eslintrc的文件，文件内容包含一些校验规则<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"rules"</span>: &#123;</div><div class="line">        <span class="string">"semi"</span>: [<span class="string">"error"</span>, <span class="string">"always"</span>],</div><div class="line">        <span class="string">"quotes"</span>: [<span class="string">"error"</span>, <span class="string">"double"</span>]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中”semi”和”quotes”是规则名称。EsLint还提供了error的级别，对应数字，数字越高错误的提示越高，如0代码错误不提示、1代表警告提醒但不影响现有编译、2error会抛出错误。<br>“extends”: “eslint:recommended”<br>Extends是EsLint默认推荐的验证，你可以使用配置选择哪些校验是你所需要的，可以登录npmjs.com查看</p>
<h3 id="二、自定义配置EsLint"><a href="#二、自定义配置EsLint" class="headerlink" title="二、自定义配置EsLint"></a>二、自定义配置EsLint</h3><p>之前提到你可以关掉所有EsLint默认的验证，自行添加所确切需要的验证规则。为此EsLint提供了2个种方式进行设置：</p>
<ul>
<li>Configuration Comments: 在所要验证的文件中，直接使用Javascript注释嵌套配置信息Configuration Files: 使用JavaScript、JSON或YAML文件，比如前面提到的.eslintrc文件，当然你也可以在package.json文件里添加eslintConfig字段，EsLint都会自动读取验证。<br>开始介绍EsLint的用法<br>parserOptions</li>
</ul>
<p>EsLint通过parserOptions，允许指定校验的ecma的版本，及ecma的一些特性<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"parserOptions"</span>: &#123;</div><div class="line">        <span class="string">"ecmaVersion"</span>: 6, //指定ECMAScript支持的版本，6为ES6</div><div class="line">        <span class="string">"sourceType"</span>: <span class="string">"module"</span>, //指定来源的类型，有两种”script”或”module”</div><div class="line">        <span class="string">"ecmaFeatures"</span>: &#123;</div><div class="line">            <span class="string">"jsx"</span>: <span class="literal">true</span>//启动JSX</div><div class="line">        &#125;,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h4><p>EsLint默认使用esprima做脚本解析，当然你也切换他，比如切换成babel-eslint解析<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"parser"</span>: <span class="string">"esprima"</span> //默认，可以设置成babel-eslint，支持jsx</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Environments"><a href="#Environments" class="headerlink" title="Environments"></a>Environments</h4><p>Environment可以预设好的其他环境的全局变量，如brower、node环境变量、es6环境变量、mocha环境变量等<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"env"</span>: &#123;</div><div class="line">        <span class="string">"browser"</span>: <span class="literal">true</span>,</div><div class="line">        <span class="string">"node"</span>: <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果你想使用插件中的环境变量，你可以使用plugins指定，如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"plugins"</span>: [<span class="string">"example"</span>],</div><div class="line">    <span class="string">"env"</span>: &#123;</div><div class="line">        <span class="string">"example/custom"</span>: <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Globals"><a href="#Globals" class="headerlink" title="Globals"></a>Globals</h4><p>指定你所要使用的全局变量，true代表允许重写、false代表不允许重写<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"globals"</span>: &#123;</div><div class="line">        <span class="string">"var1"</span>: <span class="literal">true</span>,</div><div class="line">        <span class="string">"var2"</span>: <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h4><p>EsLint允许使用第三方插件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"plugins"</span>: [</div><div class="line">        <span class="string">"react"</span>   </div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h4><p>自定义规则，一般格式：”规则名称”:error级别系数。系数0为不提示(off)、1为警告(warn)、2为错误抛出(error)，可指定范围，如[1,4]<br>可以包括Strict模式、也可以是code的方式提醒，如符号等。还可以是第三方的校验，如react。<br>默认校验的地址<a href="http://eslint.org/docs/rules/" target="_blank" rel="external">http://eslint.org/docs/rules/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"plugins"</span>: [</div><div class="line">        <span class="string">"react"</span></div><div class="line">    ],</div><div class="line">    <span class="string">"rules"</span>: &#123;</div><div class="line">         //Javascript code 默认校验</div><div class="line">        <span class="string">"eqeqeq"</span>: <span class="string">"off"</span>, //off = 0</div><div class="line">        <span class="string">"curly"</span>: <span class="string">"error"</span>, //error = 2</div><div class="line">        <span class="string">"quotes"</span>: [<span class="string">"warn"</span>, <span class="string">"double"</span>], //warn = 1</div><div class="line">         //使用第三方插件的校验规则</div><div class="line">        <span class="string">"react/jsx-quotes"</span>: 0</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="https://www.npmjs.com/package/eslint-plugin-react" target="_blank" rel="external">https://www.npmjs.com/package/eslint-plugin-react</a> ， 此链接是react的eslint使用</p>
<h3 id="三、Gulp中使用"><a href="#三、Gulp中使用" class="headerlink" title="三、Gulp中使用"></a>三、Gulp中使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var eslint = require(<span class="string">'gulp-eslint'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'validate-eslint'</span>,<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line"></div><div class="line">    <span class="built_in">return</span> gulp.src([<span class="string">'app/**/*.js'</span>]) //指定的校验路径</div><div class="line"></div><div class="line">        .pipe(eslint(&#123;configFle:<span class="string">"./.eslintrc"</span>&#125;)) //使用你的eslint校验文件</div><div class="line"></div><div class="line">        .pipe(eslint.format())</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://utopia1991.github.io/2016/10/21/eslint/" data-id="ciujicu0c0002jjtd03sfom0d" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
</article>


  


        </section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info">
      Copyright &copy; Bevis Shen 2016<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">博文</a>
  
</nav>
    

<script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>